%global project_version __VERSION__

Name:		oh-my-vagrant
Version:	__VERSION__
Release:	__RELEASE__
Summary:	An easy to use dev environment for using vagrant with puppet, docker and more!
License:	AGPLv3+
URL:		https://github.com/purpleidea/oh-my-vagrant
Source0:	https://dl.fedoraproject.org/pub/alt/purpleidea/oh-my-vagrant/SOURCES/oh-my-vagrant-%{project_version}.tar.bz2
BuildArch:	noarch

Requires: vagrant >= 1.6.5
Requires: vagrant-libvirt >= 0.0.24
# git should really be a "suggests", since technically it's optional
Requires: git
Requires: polkit-pkla-compat
# these deps are "runtime" because vagrant-hostmanager is built in userspace
# if vagrant-hostmanager is ever packaged, then these deps should go away...
Requires: ruby-devel
Requires: gcc
Requires: gcc-c++
Requires: libvirt-devel

%description
An easy to use dev environment for using vagrant with puppet, docker and more!

%prep
%setup -c -q -T -D -a 0

%build

%install
rm -rf %{buildroot}
# _datadir is typically /usr/share/
install -d -m 0755 %{buildroot}/%{_datadir}/oh-my-vagrant/
cp -r oh-my-vagrant-%{project_version}/* %{buildroot}/%{_datadir}/oh-my-vagrant/
echo %{project_version} > %{buildroot}/%{_datadir}/oh-my-vagrant/VERSION

mkdir -p %{buildroot}/%{_bindir}
install -m 0755 oh-my-vagrant-%{project_version}/bin/omv.sh %{buildroot}/%{_bindir}/omv

mkdir -p %{buildroot}%{_sysconfdir}/profile.d
install oh-my-vagrant-%{project_version}/extras/vagrant.bashrc -m 0755 %{buildroot}%{_sysconfdir}/profile.d/oh-my-vagrant.sh

# pkla file for users in vagrant group
# NOTE: this can apparently give you root access, see:
# https://bugzilla.redhat.com/show_bug.cgi?id=1187019#c10
mkdir -p %{buildroot}%{_sysconfdir}/polkit-1/localauthority/50-local.d/
install -m 0644 oh-my-vagrant-%{project_version}/extras/oh-my-vagrant.pkla %{buildroot}%{_sysconfdir}/polkit-1/localauthority/50-local.d/oh-my-vagrant.pkla

%files
%attr(0755, root, root) %{_sysconfdir}/profile.d/oh-my-vagrant.sh
%{_datadir}/oh-my-vagrant/*
%{_bindir}/omv
%{_sysconfdir}/polkit-1/localauthority/50-local.d/oh-my-vagrant.pkla

# this changelog is auto-generated by git log
%changelog
